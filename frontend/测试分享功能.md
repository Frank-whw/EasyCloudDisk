# 🧪 测试分享功能指南

## 问题解决

如果遇到 `api.getUserShares is not a function` 错误，请按以下步骤操作：

### 1. 检查浏览器缓存
```bash
# 强制刷新页面（清除缓存）
Ctrl + F5 (Windows)
Cmd + Shift + R (Mac)
```

### 2. 使用调试工具
访问 `debug-share.html` 页面进行诊断：
```
http://localhost:3000/debug-share.html
```

### 3. 检查控制台错误
1. 按 F12 打开开发者工具
2. 查看 Console 标签页的错误信息
3. 查看 Network 标签页的网络请求

## 快速测试步骤

### 第一步：启动服务
```bash
# 1. 启动后端服务器
cd EasyCloudDisk/server
mvn spring-boot:run

# 2. 启动前端服务器
cd EasyCloudDisk/frontend
test-start.bat  # Windows
# 或 python -m http.server 3000
```

### 第二步：登录系统
1. 访问 `http://localhost:3000`
2. 注册新账号或使用现有账号登录
3. 确保能看到主界面

### 第三步：上传测试文件
1. 点击"上传文件"按钮
2. 选择一个小文件（如文本文件）
3. 等待上传完成

### 第四步：创建分享
1. 找到刚上传的文件
2. 点击文件旁边的 **🔗 分享** 按钮
3. 在弹出的对话框中：
   - 保持默认设置
   - 或设置访问密码
   - 点击"创建分享"
4. 复制生成的分享链接

### 第五步：测试分享访问
1. 打开新的浏览器窗口（或无痕模式）
2. 粘贴分享链接访问
3. 如果设置了密码，输入密码验证
4. 尝试下载文件

### 第六步：管理分享
1. 在主界面点击侧边栏的"我的分享"
2. 查看分享列表
3. 尝试复制链接或取消分享

## 常见问题解决

### 问题1：API方法不存在
**现象**：`api.getUserShares is not a function`

**解决方案**：
1. 检查 `js/api.js` 文件是否正确加载
2. 清除浏览器缓存并刷新
3. 查看浏览器控制台是否有JavaScript错误

### 问题2：分享创建失败
**现象**：点击"创建分享"后出现错误

**可能原因**：
- 后端服务未启动
- 用户未登录或token过期
- 文件不存在或无权限

**解决方案**：
1. 确认后端服务正常运行
2. 重新登录
3. 检查文件是否存在

### 问题3：分享链接无法访问
**现象**：访问分享链接显示错误

**可能原因**：
- 分享已过期或被取消
- 后端服务不可访问
- CORS配置问题

**解决方案**：
1. 检查分享是否仍然有效
2. 确认后端服务运行正常
3. 检查CORS配置

### 问题4：无法下载分享文件
**现象**：点击下载按钮无反应或失败

**可能原因**：
- 文件在存储中不存在
- 权限不足
- 网络问题

**解决方案**：
1. 检查文件是否在S3或本地存储中存在
2. 确认分享权限设置正确
3. 检查网络连接

## 调试技巧

### 使用浏览器开发者工具
```javascript
// 在控制台中检查API对象
console.log('API对象:', api);
console.log('API方法:', Object.getOwnPropertyNames(Object.getPrototypeOf(api)));

// 检查分享管理器
console.log('分享管理器:', shareManager);

// 手动测试API调用
api.get('/shares').then(console.log).catch(console.error);
```

### 查看网络请求
1. 打开开发者工具的 Network 标签页
2. 执行分享操作
3. 查看HTTP请求和响应
4. 检查状态码和错误信息

### 检查本地存储
```javascript
// 查看认证信息
console.log('Token:', localStorage.getItem('authToken'));
console.log('User:', localStorage.getItem('userEmail'));

// 清除认证信息（如果需要重新登录）
localStorage.clear();
```

## 功能验证清单

- [ ] 能够成功登录系统
- [ ] 能够上传文件
- [ ] 能够看到文件的分享按钮
- [ ] 能够打开分享对话框
- [ ] 能够创建分享（无密码）
- [ ] 能够创建分享（有密码）
- [ ] 能够复制分享链接
- [ ] 能够访问分享链接
- [ ] 能够下载分享文件
- [ ] 能够查看"我的分享"列表
- [ ] 能够取消分享
- [ ] 分享帮助功能正常

## 获取帮助

如果仍然遇到问题：

1. **查看详细日志**：
   - 浏览器控制台错误
   - 后端服务日志
   - 网络请求详情

2. **使用调试页面**：
   - `debug-share.html` - 功能调试
   - `test-share.html` - API测试

3. **检查配置**：
   - 后端服务地址
   - CORS设置
   - 数据库连接

4. **重置环境**：
   - 清除浏览器缓存
   - 重启服务
   - 重新登录
